# IoT项目运行指南

本指南将帮助您在Mosquitto服务器环境下运行IoT项目。

## 系统要求

- Python 3.9或更高版本
- Mosquitto MQTT服务器
- 已安装的依赖库：paho-mqtt、pandas、flask等

## 一、确认Mosquitto服务器运行状态

1. **检查Mosquitto服务器是否已安装**：
   ```
   mosquitto --version
   ```

2. **确认Mosquitto服务器是否正在运行**：
   ```
   netstat -ano | findstr :1883
   ```
   如果看到类似输出，说明Mosquitto服务器正在运行：
   ```
   TCP    127.0.0.1:1883         0.0.0.0:0              LISTENING       4952
   ```

3. **如果需要启动Mosquitto服务器**：
   ```
   mosquitto -v
   ```

## 二、运行项目

### 1. 启动发布端（Publish）

在第一个终端窗口中执行：

```
python publish_app.py
```

发布端将在 `http://127.0.0.1:5000/` 启动。

**发布端功能**：
- 连接到Mosquitto服务器
- 发布随机生成的温度、湿度和气压数据
- 发布CSV文件中的历史数据

### 2. 启动订阅端（Subscribe）

在第二个终端窗口中执行：

```
python subscribe_app.py
```

订阅端将在 `http://127.0.0.1:5001/` 启动。

**订阅端功能**：
- 连接到Mosquitto服务器并订阅所有主题
- 接收并显示实时数据
- 将数据保存到CSV文件
- 提供数据可视化界面

## 三、使用说明

### 1. 使用发布端

1. 打开浏览器，访问 `http://127.0.0.1:5000/`
2. 点击"connect"按钮连接到Mosquitto服务器
3. 点击"Pub Random"发布一条随机数据
4. 点击"Pub ALL"发布CSV文件中的所有数据
5. 右侧日志栏将显示操作结果

### 2. 使用订阅端

1. 打开浏览器，访问 `http://127.0.0.1:5001/`
2. 输入任意ClientID、用户名和密码（Mosquitto默认不需要认证）
3. 点击"订阅"按钮连接到Mosquitto服务器
4. 您将看到实时接收的数据
5. 可以选择要显示的数据类型（温度、湿度、气压）
6. 点击"断开连接"按钮结束会话

## 四、数据流程

1. 发布端生成或读取数据
2. 发布端通过MQTT协议将数据发送到Mosquitto服务器
3. 订阅端从Mosquitto服务器接收数据
4. 订阅端处理数据并存储到CSV文件
5. 前端显示实时数据和历史数据图表

## 五、注意事项

1. **端口冲突**：确保端口1883（Mosquitto）、5000（发布端）和5001（订阅端）未被占用
2. **Mosquitto配置**：默认Mosquitto服务器只允许本地连接，如果需要远程访问，请修改Mosquitto配置文件
3. **数据格式**：系统支持两种数据格式：阿里云格式和直接格式，确保发布的数据符合其中一种格式
4. **CSV文件**：确保publish_data.csv文件存在于项目根目录，否则发布端将无法发布历史数据

## 六、故障排除

1. **无法连接到Mosquitto服务器**：
   - 检查Mosquitto服务器是否正在运行
   - 确保防火墙没有阻止端口1883

2. **发布端无法发布数据**：
   - 检查发布端是否成功连接到服务器
   - 检查发布主题是否正确

3. **订阅端无法接收数据**：
   - 检查订阅端是否成功连接到服务器
   - 检查订阅主题是否正确
   - 确保发布端正在发布数据

4. **前端无法显示数据**：
   - 检查浏览器控制台是否有错误
   - 确保后端服务器正在运行
   - 检查网络连接是否正常

如果遇到其他问题，请查看终端窗口中的错误信息，或联系项目开发人员。